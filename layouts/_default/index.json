{{- $.Scratch.Add "index" slice -}}
{{- $siteTaxonomies := .Site.Taxonomies -}}
{{- range .Site.RegularPages -}}
  {{- $page := . -}}
  {{- $includeInSearch := true -}}
  {{- if isset $page.Params "search" -}}
    {{- $includeInSearch = ne (lower (printf "%v" (index $page.Params "search"))) "false" -}}
  {{- end -}}
  {{- if $includeInSearch -}}
    {{- $pageType := lower (printf "%v" $page.Type) -}}
    {{- $pageSection := lower (printf "%v" $page.Section) -}}
    {{- $pageLayout := lower (printf "%v" $page.Layout) -}}
    {{- $translationBase := "" -}}
    {{- with $page.File -}}
      {{- $translationBase = lower .TranslationBaseName -}}
    {{- end -}}
    {{- if or (eq $pageType "search") (eq $pageSection "search") (eq $pageLayout "search") -}}
      {{- $includeInSearch = false -}}
    {{- end -}}
    {{- if eq $translationBase "search" -}}
      {{- $includeInSearch = false -}}
    {{- end -}}
    {{- $relPermalink := lower (printf "%v" $page.RelPermalink) -}}
    {{- if or (eq $relPermalink "/search") (eq $relPermalink "/search/") (hasSuffix $relPermalink "/search") (hasSuffix $relPermalink "/search/") -}}
      {{- $includeInSearch = false -}}
    {{- end -}}
  {{- end -}}
  {{- if $includeInSearch -}}
    {{- $taxonomyData := dict -}}
    {{- range $taxonomyName, $_ := $siteTaxonomies -}}
      {{- with (index $page.Params $taxonomyName) -}}
        {{- $taxonomyData = merge $taxonomyData (dict $taxonomyName .) -}}
      {{- end -}}
    {{- end -}}
    {{- $sectionLabel := "" -}}
    {{- with $page.CurrentSection -}}
      {{- $sectionLabel = .LinkTitle -}}
    {{- end -}}
    {{- if and (not $sectionLabel) ($page.Section) -}}
      {{- $sectionLabel = humanize $page.Section -}}
    {{- end -}}
    {{- $.Scratch.Add "index" (dict "title" $page.Title "tags" $page.Params.tags "categories" $page.Params.categories "taxonomies" $taxonomyData "section" $page.Section "sectionLabel" $sectionLabel "contents" $page.Plain "permalink" $page.Permalink) -}}
  {{- end -}}
{{- end -}}
{{- $.Scratch.Get "index" | jsonify -}}
