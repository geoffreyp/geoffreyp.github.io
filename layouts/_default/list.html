{{ define "main" }}
<div class="list flex-grow-1"> 
  <section id="main-content" class="section list-{{ .Kind }}">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <h1 class="mb-4">{{ .Title }}</h1>
          
          {{ if eq .Kind "taxonomy" }}
            {{/* All tags or categories page */}}
            <div class="taxonomy-page">
              {{ if eq .Type "tags" }}
                {{/* Tags: pill-based grid layout */}}
                <ul class="list-taxonomy rad-animation-group">
                  {{ range .Data.Terms.ByCount }}
                    <li class="rad-fade-down rad-animate">
                      <a href="{{ .Page.RelPermalink }}">
                        {{ .Page.Title }}
                        <span class="badge taxonomy-count">{{ .Count }}</span>
                      </a>
                    </li>
                  {{ end }}
                </ul>
              {{ else }}
                {{/* Categories: card-based layout */}}
                <div class="row g-4">
                  {{ range .Data.Terms.ByCount }}
                    <div class="col-12 col-md-6 col-lg-4 rad-animation-group rad-fade-down rad-animate">
                      <div class="card h-100 category-card">
                        <div class="card-body">
                          <h3 class="card-title h5">
                            <a href="{{ .Page.RelPermalink }}" class="text-decoration-none stretched-link">
                              {{ .Page.Title }}
                            </a>
                          </h3>
                          <p class="card-text text-muted mb-0">
                            {{ .Count }} {{ if eq .Count 1 }}post{{ else }}posts{{ end }}
                          </p>
                        </div>
                      </div>
                    </div>
                  {{ end }}
                </div>
              {{ end }}
            </div>
          {{ else if eq .Kind "term" }}
            {{/* Individual tag or category page with posts */}}
            <div class="term-page">
              <div class="row">
                <div class="col-12 col-lg-8">
                  {{ $paginator := .Paginate .Pages }}
                  <ul class="posts-list-simple">
                    {{ range $paginator.Pages }}
                      <li class="post rad-animation-group rad-fade-down rad-animate">
                        <a href="{{ .RelPermalink }}">{{ .LinkTitle }}</a>
                        <div class="meta">{{ .Date.Format "Mon, Jan 2, 2006" }}</div>
                      </li>
                    {{ end }}
                  </ul>
                  
                  {{ if gt $paginator.TotalPages 1 }}
                    <nav aria-label="Page navigation" class="mt-5">
                      <ul class="pagination justify-content-center">
                        {{ if $paginator.HasPrev }}
                          <li class="page-item">
                            <a class="page-link" href="{{ $paginator.Prev.URL }}" aria-label="Previous">
                              <span aria-hidden="true">&laquo;</span>
                            </a>
                          </li>
                        {{ end }}
                        
                        {{ $window := 2 }}
                        {{ $current := $paginator.PageNumber }}
                        {{ $total := $paginator.TotalPages }}
                        {{ $scratch := newScratch }}
                        {{ $scratch.Set "leftDots" false }}
                        {{ $scratch.Set "rightDots" false }}

                        {{ range $paginator.Pagers }}
                          {{ $n := .PageNumber }}
                          {{ $inWindow := and (ge $n (sub $current $window)) (le $n (add $current $window)) }}

                          {{ if or (eq $n 1) (eq $n $total) $inWindow }}
                            <li class="page-item {{ if eq . $paginator }}active{{ end }}">
                              <a class="page-link" href="{{ .URL }}">{{ .PageNumber }}</a>
                            </li>
                          {{ else if and (eq $n 2) (gt (sub $current $window) 2) (not ($scratch.Get "leftDots")) }}
                            <li class="page-item disabled" aria-hidden="true">
                              <span class="page-link">&hellip;</span>
                            </li>
                            {{ $scratch.Set "leftDots" true }}
                          {{ else if and (eq $n (sub $total 1)) (lt (add $current $window) (sub $total 1)) (not ($scratch.Get "rightDots")) }}
                            <li class="page-item disabled" aria-hidden="true">
                              <span class="page-link">&hellip;</span>
                            </li>
                            {{ $scratch.Set "rightDots" true }}
                          {{ end }}
                        {{ end }}
                        
                        {{ if $paginator.HasNext }}
                          <li class="page-item">
                            <a class="page-link" href="{{ $paginator.Next.URL }}" aria-label="Next">
                              <span aria-hidden="true">&raquo;</span>
                            </a>
                          </li>
                        {{ end }}
                      </ul>
                    </nav>
                  {{ end }}
                </div>
                
                <div class="col-12 col-lg-4">
                  {{/* Popular tags sidebar widget */}}
                  {{ partial "widgets/popular-tags.html" . }}
                </div>
              </div>
            </div>
          {{ else }}
            {{/* Regular list pages (blog, etc.) */}}
            {{ if eq .Site.Params.blog.listStyle "summary" }}
              <div class="posts-list">
                {{ range .Pages }}
                  <div class="row row--padded rad-animation-group rad-fade-down rad-waiting rad-animate section--border-bottom">
                    {{ .Render "summary" }}
                  </div>
                {{ end }}
              </div>
            {{ else }}
              <ul class="posts-list-simple">
                {{ range .Pages }}
                  {{ .Render "li" }}
                {{ end }}
              </ul>
            {{ end }}
          {{ end }}
        </div>
      </div>
    </div>
  </section>
</div>
{{ end }}